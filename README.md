# Описание сервиса интеграции с amoCRM и Unisender

Сервис интеграции предназначен для связи между amoCRM и Unisender. С помощью этого сервиса вы можете автоматически отправлять контакты из amoCRM в Unisender. Сервис также предоставляет различные функции, такие как управление аккаунтами, авторизация и запрос данных.

## Начало работы

Чтобы начать работу с сервисом, выполните следующие действия:

1. Скачайте проект.
2. Откройте терминал и перейдите в папку проекта.
3. Запустите контейнер Docker с помощью команды `sudo docker compose up`.
4. Запустите ngrok с помощью команды `ngrok http 8080`.
   Примечание: Для корректной работы виджета в `ngrok_url` необходимо добавить `/vidget`.

## Интеграция с amoCRM

Сервис является интеграцией в виде виджета для amoCRM. Для этого в amoCRM требуется добавить виджет, который будет вызывать API сервиса интеграции.

Для начала работы с сервисом нужно заполнить информацию о `secret_key` и `redirect_url` в файле `.env` проекта. Примечание: Для корректной работы виджета в `redirect_url` необходимо добавить `/vidget`.

## Endpoints

Сервис имеет следующие endpoints:

- `/accounts`:
    - `POST {account_id}` - создать новый аккаунт
    - `GET` - получить список всех доступных аккаунтов
    - `PUT {account_id}` - изменить аккаунт
    - `DELETE {account_id}` - удалить аккаунт
- `/accounts/integrations`:
    - `GET {account_id}` - получить информацию о интеграциях аккаунта
- `/accounts/unsync`:
    - `GET` - получить информацию о несинхронизированных контактах
- `/accounts/sync`:
    - `GET` - получить информацию о синхронизированных контактах
- `/integrations`:
    - `PUT {account_id}` - обновить информацию о интеграции в аккаунте
    - `DELETE {account_id}` - удалить интеграцию в аккаунте
- `/request`:
    - `DELETE {account_id}` - удалить интеграцию в аккаунте
- `/webhookwork`:
    - `GET` - выполнение системы очередей
- `/sync`:
    - `POST` - выполнение синхронизации контактов
- `/acchasuni`:
    - `GET` - проверка аккаунта на подключение к Unisender


## Системные endpoints

- `/vidget` - GET запрос, который обрабатывает информацию о подключении виджета.
- `/vidget/unisender` - POST запрос, который обрабатывает информацию после добавления api_key.

## Авторизация в amoCRM и Unisender

Авторизация в amoCRM и Unisender происходит в момент подключения к приватной интеграции и сохранения `Unisender_api` для получения доступа к контактам. Авторизация также сохраняется в базе данных.

## Синхронизация списка контактов из amoCRM

Для получения списка контактов из amoCRM сервис запрашивает необходимые доступы и отправляет их в Unisender. Запрос делается с помощью POST запроса на `/sync`. После запроса сервис сохраняет несинхронизированные контакты в `memory_database`, а синхронизированные в связанную с аккаунтом таблицу `contacts`.

## Управление аккаунтами

Сервис может добавлять, получать и удалять информацию, связанную с аккаунтами, посредством запросов на `/accounts` endpoints.

## Вебхуки

Сервис может обрабатывать вебхуки на добавление, изменение и удаление контактов.

## Отключение учетной записи от сервиса

Сервис имеет возможность отключать учетную запись от сервиса посредством RPC запроса в теле которого будет указан `account_id`. Формат запроса будет определен редактором текста.


Заключение
   Сервис интеграции для amoCRM и Unisender, который будет удобен в использовании и позволит вам сохранять и обрабатывать контакты вашей CRM системы.
   Он представляет собой виджет, интегрированный в amoCRM, который позволяет авторизовываться в Unisender и запрашивать нужные доступы для получения списка контактов. Он также обеспечивает сохранение и поддержку авторизации, что позволяет быстро и удобно работать с данными.
   Сервис  умеет получать список контактов из amoCRM и сохранять их значения email в базе данных. Затем авторизуется и получаем доступ к Unisender, где отправляет контакты из списка. Так же сервис поддерживает работу со множеством аккаунтов, что позволяет управлять данными разных компаний.
   Он также может ответить на ряд запросов, включая показ несинхронизированных и синхронизированных контактов, список авторизованных учетных записей, список интеграций учетных записей и состояние подключения к Unisender. Кроме того, он позволяем отвязать учетную запись посредством RPC запроса, если это необходимо. Сервис интеграции для amoCRM и Unisender представляет собой надежный и удобный инструмент для обработки контактов. 
